(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{7737:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.id?a("div",{staticClass:"row q-pa-md"},[a("div",{staticClass:"col-12"},[a("q-card",{staticClass:"full-width q-pa-md",staticStyle:{"min-height":"80vh"}},[e._t("form"),e.hideFooter?e._e():a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 flex justify-end"},[a("q-btn",{staticClass:"q-mr-sm q-my-sm",attrs:{color:"primary",unelevated:"",label:"Salvar registro",icon:"las la-save"},on:{click:function(t){return e.saveItem()}}}),a("q-btn",{staticClass:"q-my-sm",attrs:{color:"negative",unelevated:"",label:"Limpar formulário",icon:"las la-sync"},on:{click:function(t){return e.resetForm()}}})],1)])],2)],1)]):a("div",{staticClass:"row q-pa-sm"},[a("div",{staticClass:"col-12"},[a("div",{staticClass:"row justify-end"},[a("q-btn",{staticClass:"q-mr-sm q-my-sm",attrs:{color:"primary",unelevated:"",label:"Novo registro",icon:"las la-plus"},on:{click:function(t){return e.redirectItem()}}}),a("q-btn",{staticClass:"q-my-sm",attrs:{color:"negative",unelevated:"",label:"Excluir registros",icon:"las la-trash",disabled:!e.selected.length},on:{click:function(t){return e.deleteItems()}}})],1),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 q-pa-sm"},[a("q-input",{attrs:{dense:"",outlined:"",placeholder:"Pesquisar..."},on:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getItems()}},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"las la-search"},on:{click:function(t){return e.getItems()}}})]},proxy:!0}],null,!1,2430780537),model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)]),a("q-table",{attrs:{data:e.items.data,columns:e.columns,"row-key":"id",selection:"multiple",selected:e.selected,"hide-pagination":"",loading:e.loading_data},on:{"update:selected":function(t){e.selected=t},"row-dblclick":function(t,a,s){return e.redirectItem(a.id)}}}),a("q-pagination",{staticClass:"justify-center q-my-sm",attrs:{color:"primary",max:e.items.last_page,"max-pages":6,"boundary-numbers":""},on:{input:e.getItems},model:{value:e.items.current_page,callback:function(t){e.$set(e.items,"current_page",t)},expression:"items.current_page"}})],1)])])},i=[],o=(a("a79d"),{name:"PageData",props:["id","data","columns","hide-footer"],data:()=>({form:{},loading_data:!1,search:"",items:{},selected:[],errors:{}}),computed:{endpoint:function(){let e=this.$route.fullPath.split("/");return e.pop(),e.join("/")}},watch:{data:function(e){Object.keys(e).length&&(this.form=this.data)}},methods:{getItems(e=1){let t=this;t.loading_data=!0,t.$axios.get(`${t.$route.fullPath}?page=${e}&search=${t.search}`).then((({data:e})=>t.items=e)).catch((e=>{t.$swal.fire("Erro!","Ocorreu um erro ao tentar listar registros!","error")})).finally((()=>{t.loading_data=!1}))},getItem(){let e=this;e.id&&"new"!=e.id&&e.$axios.get(e.$route.fullPath).then((({data:t})=>{e.$emit("load-data",t),e.form=t})).catch((t=>{e.$swal.fire("Erro!","Ocorreu um erro ao tentar exibir dados!","error")}))},redirectItem(e="new"){location.href=`${location.origin}${this.$route.fullPath}/${e}`},saveItem(){let e=this;e.$loadingMsg("Salvando alterações");let t=(t,a)=>{e.$axios.post(t,e.form).then((({data:t})=>{e.$swal.fire("Sucesso",`Cadastro ${a} com sucesso!`,"success").then((t=>{location.href=`${location.origin}${e.endpoint}`}))})).catch((t=>{422==t.response.status&&t.response.hasOwnProperty("data")?(e.$swal.fire("Erro!","Ocorreram erros de validação","error"),e.$emit("error",t.response.data.errors)):e.$swal.fire("Erro!","Ocorreu um erro ao tentar salvar os dados","error")}))};"new"==e.id?t(`${e.endpoint}/store`,"criado"):parseInt(e.id)&&t(`${e.endpoint}/update/${e.id}`,"atualizado")},deleteItems(){let e=this;e.$swal.fire({title:"Excluir",icon:"question",text:"Deseja remover os items selecionados?",showCancelButton:!0,confirmButtonText:"Sim",cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&(e.$loadingMsg("Removendo registros"),e.$axios.delete(`${e.$route.fullPath}/delete`,{data:{items:e.selected.map((e=>e.id))}}).then((t=>{e.$swal.fire("Sucesso!","Items removidos com sucesso!","success"),e.selected=[],e.getItems(e.items.current_page)})).catch((t=>e.$swal.fire("Erro!","Ocorreu um erro ao tentar excluir os items!","error"))))}))},resetForm(){let e=this,t={id:e.form.id};e.$emit("load-data",t),e.form=t}},mounted(){this.id&&"new"!=this.id?this.getItem():"new"!=this.id&&this.getItems()}}),r=o,n=a("2877"),c=a("9c40"),l=a("27f9"),d=a("0016"),m=a("eaac"),u=a("3b16"),p=a("f09f"),h=a("eebe"),v=a.n(h),f=Object(n["a"])(r,s,i,!1,null,null,null);t["a"]=f.exports;v()(f,"components",{QBtn:c["a"],QInput:l["a"],QIcon:d["a"],QTable:m["a"],QPagination:u["a"],QCard:p["a"]})},a8f0:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("page-data",{attrs:{id:e.id,data:e.form,columns:e.columns},on:{"load-data":e.loadData,error:function(t){e.errors=t}},scopedSlots:e._u([{key:"form",fn:function(){return[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 q-pa-sm"},[a("div",{staticClass:"q-pb-sm"},[e._v("Nome do Paciente"),a("span",{staticClass:"text-negative"},[e._v("*")]),e._v(":")]),a("q-select",{attrs:{dense:"",outlined:"",placeholder:"Digite o Nome","option-label":"name","option-value":"id","emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"",options:e.patients.data,"dropdown-icon":"las la-angle-down"},on:{filter:e.searchPatients},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                Nenhum item encontrado\n              ")])],1)]},proxy:!0}]),model:{value:e.form.patient_id,callback:function(t){e.$set(e.form,"patient_id",t)},expression:"form.patient_id"}}),a("p",{staticClass:"text-negative"},[e._v(e._s(e.$getError(e.errors,"patient_id")))])],1),a("div",{staticClass:"col-12 col-sm-6 q-pa-sm"},[a("div",{staticClass:"q-pb-sm"},[e._v("Vacina"),a("span",{staticClass:"text-negative"},[e._v("*")]),e._v(":")]),a("q-select",{attrs:{dense:"",outlined:"",placeholder:"Digite a Vacina","option-label":"name","option-value":"id","emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"",options:e.vaccines.data,"dropdown-icon":"las la-angle-down"},on:{filter:e.searchVaccines},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                Nenhum item encontrado\n              ")])],1)]},proxy:!0}]),model:{value:e.form.vaccine_id,callback:function(t){e.$set(e.form,"vaccine_id",t)},expression:"form.vaccine_id"}}),a("p",{staticClass:"text-negative"},[e._v(e._s(e.$getError(e.errors,"vaccine_id")))])],1),a("div",{staticClass:"col-12 col-sm-6 q-pa-sm"},[a("div",{staticClass:"q-pb-sm"},[e._v("Fabricante"),a("span",{staticClass:"text-negative"},[e._v("*")]),e._v(":")]),a("q-select",{attrs:{dense:"",outlined:"",placeholder:"Digite o Fabricante","option-label":"name","option-value":"id","emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"",options:e.vendors.data,"dropdown-icon":"las la-angle-down",disabled:e.history.vendor_id},on:{filter:e.searchVendors},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                Nenhum item encontrado\n              ")])],1)]},proxy:!0}]),model:{value:e.form.vendor_id,callback:function(t){e.$set(e.form,"vendor_id",t)},expression:"form.vendor_id"}}),a("p",{staticClass:"text-negative"},[e._v(e._s(e.$getError(e.errors,"vendor_id")))])],1),a("div",{staticClass:"col-12 col-sm-6 q-pa-sm"},[a("div",{staticClass:"q-pb-sm"},[e._v("Lote"),a("span",{staticClass:"text-negative"},[e._v("*")]),e._v(":")]),a("q-select",{attrs:{dense:"",outlined:"",placeholder:"Digite o Lote","use-input":"","fill-input":"","hide-selected":"",options:e.batchs,"dropdown-icon":"las la-angle-down",disabled:!Object.keys(e.stocks).length},on:{filter:e.searchBatchs},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                Nenhum item encontrado\n              ")])],1)]},proxy:!0}]),model:{value:e.form.batch,callback:function(t){e.$set(e.form,"batch",t)},expression:"form.batch"}}),a("p",{staticClass:"text-negative"},[e._v(e._s(e.$getError(e.errors,"batch")))])],1),a("div",{staticClass:"col-12 col-sm-6 q-pa-sm"},[a("div",{staticClass:"q-pb-sm"},[e._v("Validade"),a("span",{staticClass:"text-negative"},[e._v("*")]),e._v(":")]),a("q-select",{attrs:{dense:"",outlined:"",placeholder:"Digite a Validade","use-input":"","fill-input":"","hide-selected":"",options:e.validities,"dropdown-icon":"las la-angle-down",disabled:!e.form.batch},on:{filter:e.searchValidities},scopedSlots:e._u([{key:"no-option",fn:function(){return[a("q-item",[a("q-item-section",{staticClass:"text-grey"},[e._v("\n                Nenhum item encontrado\n              ")])],1)]},proxy:!0}]),model:{value:e.form.validity,callback:function(t){e.$set(e.form,"validity",t)},expression:"form.validity"}}),a("p",{staticClass:"text-negative"},[e._v(e._s(e.$getError(e.errors,"validity")))])],1)])]},proxy:!0}])})},i=[],o=a("ded3"),r=a.n(o),n=a("7737"),c={name:"PatientVaccinations",props:["id"],components:{PageData:n["a"]},data:()=>({form:{patient_id:null,vendor_id:null,vaccine_id:null},errors:{},patients:{data:[],search:null},vaccines:{data:[],search:null},vendors:{data:[],search:null},batchs:[],validities:[],stocks:{},history:{patient_id:null,vaccine_id:null,vendor_id:null,error:!1},columns:[{field:"id",label:"Cód."},{field:"patient_name",label:"Paciente"},{field:"vaccine_name",label:"Vacina"},{field:"vendor_name",label:"Fabricante"},{field:"created_at",label:"Data vacinação"}]}),watch:{"form.patient_id":function(e){e&&this.checkHistory()},"form.vaccine_id":function(e){e&&this.checkHistory()},"form.vendor_id":{handler(e,t){e&&this.getStocks()},deep:!0}},methods:{loadData(e){this.form=r()(r()({},this.form),e)},getSearch(e="",t){let a=this;a.$axios.get(`/admin/${t}?page=1&search=${encodeURIComponent(e)}`).then((({data:e})=>a[t].data=e.data)).catch((e=>a.$swal.fire("Erro!","Ocorreu um erro ao pesquisar items")))},getSelectedItem(e,t){let a=this;e&&a.$axios.get(`/admin/${t}/${e}`).then((({data:e})=>a[t].data.push(e))).catch((e=>a.$swal.fire("Erro!","Ocorreu um erro ao pesquisar items")))},searchPatients(e,t,a){let s=this,i=e.toLowerCase();t((()=>{s.vendors.search!=i&&(s.vendors.search=i,s.getSearch(i,"patients"))}))},searchVaccines(e,t,a){let s=this,i=e.toLowerCase();t((()=>{s.vaccines.search!=i&&(s.vaccines.search=i,s.getSearch(i,"vaccines"))}))},searchVendors(e,t,a){let s=this,i=e.toLowerCase();s.history.vendor_id?a():t((()=>{s.vendors.search!=i&&(s.vendors.search=i,s.getSearch(i,"vendors"))}))},searchBatchs(e,t,a){let s=this,i=Object.keys(s.stocks);if(!i.length||s.history.error)return void a();let o=e.toLowerCase();t((()=>{s.batchs=i.filter((e=>e.toLowerCase().indexOf(o)>-1))}))},searchValidities(e,t,a){let s=this;if(s.form.hasOwnProperty("batch")&&s.form.batch){let a=s.stocks[s.form.batch].map((e=>e.validity)),i=e.toLowerCase();t((()=>{s.validities=a.filter((e=>e.toLowerCase().indexOf(i)>-1))}))}else a()},checkHistory(){let e=this;if(e.history.vaccine_id!=e.form.vaccine_id&&e.history.patient_id!=e.form.patient_id&&e.form.vaccine_id&&e.form.patient_id&&"new"==e.id){let t={vaccine_id:e.form.vaccine_id,patient_id:e.form.patient_id};e.$axios.post("/admin/patient-vaccinations/history",t).then((({data:t})=>{e.history.vendor_id=t.vendor_id,e.form.vendor_id=t.vendor_id})).catch((t=>{e.form=r()(r()({},e.form),{},{patient_id:null,vaccine_id:null,vendor_id:null,batch:null,validity:null}),t.response.hasOwnProperty("data")&&t.response.data.hasOwnProperty("error")?e.$swal.fire("Erro!",t.response.data.error,"error"):e.$swal.fire("Erro!","Ocorreu um erro ao consultar o histórico do paciente","error")}))}},getStocks(){let e=this;e.$axios.get(`/admin/patient-vaccinations/stocks/${e.form.vendor_id}`).then((({data:t})=>{e.stocks=t})).catch((t=>{e.stocks={},t.response.hasOwnProperty("data")&&t.response.data.hasOwnProperty("error")?e.$swal.fire("Erro!",t.response.data.error,"error"):e.$swal.fire("Erro!","Ocorreu um erro ao consultar os estoques de vacina","error")}))}},mounted(){this.id&&(this.getSearch("","patients"),this.getSearch("","vaccines"),this.getSearch("","vendors"),"new"!=this.id&&(this.getSelectedItem(this.form.vendor_id,"patients"),this.getSelectedItem(this.form.vaccine_id,"vaccines"),this.getSelectedItem(this.form.vendor_id,"vendors")))}},l=c,d=a("2877"),m=a("ddd8"),u=a("66e5"),p=a("4074"),h=a("eebe"),v=a.n(h),f=Object(d["a"])(l,s,i,!1,null,null,null);t["default"]=f.exports;v()(f,"components",{QSelect:m["a"],QItem:u["a"],QItemSection:p["a"]})}}]);